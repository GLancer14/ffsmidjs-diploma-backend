generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           Int     @id @default(autoincrement())
  email        String  @unique
  passwordHash String
  name         String
  contactPhone String?
  role         String  @default("client")
}

model Library {
  id          Int             @id @default(autoincrement())
  name        String
  address     String
  description String?
  book        BookOnLibrary[]
  createdAt   DateTime
  updatedAt   DateTime
}

model Book {
  id          Int             @id @default(autoincrement())
  library     BookOnLibrary[]
  title       String
  author      String
  year        Int?
  description String?
  coverImage  String?
}

model BookOnLibrary {
  book            Book    @relation(fields: [bookId], references: [id])
  bookId          Int
  library         Library @relation(fields: [libraryId], references: [id], onDelete: Cascade)
  libraryId       Int
  totalCopies     Int     @default(1)
  availableCopies Int     @default(1)
  isAvailable     Boolean @default(true)

  @@id([bookId, libraryId])
}

model BookRental {
  id        Int      @id @default(autoincrement())
  userId    Int
  libraryId Int
  bookId    Int
  dateStart DateTime
  dateEnd   DateTime
  status    String   @default("reserved")
}

model SupportRequest {
  id        Int       @id @default(autoincrement())
  user      Int
  createdAt DateTime
  isActive  Boolean
  messages  Message[]
}

model Message {
  id               Int            @id @default(autoincrement())
  author           Int
  sentAt           DateTime
  text             String
  readAt           DateTime?
  supportRequest   SupportRequest @relation(fields: [supportRequestId], references: [id])
  supportRequestId Int
}
